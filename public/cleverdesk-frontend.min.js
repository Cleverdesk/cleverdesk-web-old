frontendApp=angular.module("frontendApp",["ngRoute"]);frontendApp.controller("frontendCtrl",function($scope,$log,communicator){});frontendApp.config(function($routeProvider,$locationProvider){$routeProvider.when("/",{templateUrl:"src/html/templates/page.html",controller:"HomeController"}).when("/auth",{templateUrl:"src/html/templates/auth.html",controller:"AuthController"}).when("/:plugin/:page",{templateUrl:"src/html/templates/page.html",controller:"PageController"})});frontendApp.controller("AuthController",function($scope,$log,$location,auth){$scope.auth=function(){auth.auth($scope.username,$scope.password).then(function(){$scope.refreshPages();$location.path("/")},function(){$scope.error=true})}});frontendApp.controller("HomeController",function($scope,$log,$routeParams,communicator,parser){communicator.getPage("cleverdesk","home").then(function(page){parser.parsePage(page).then(function(components){$scope.components=components;$scope.$apply()})},function(e){$scope.components=[{name:"Label",text:"Home Not Found"},{name:"Label",text:"No Home Page has been set!!!"}];$scope.$apply()})});frontendApp.controller("MainController",function($scope,$log,$location,communicator){$scope.refreshPages=function(){communicator.getPages().then(function(pages){$scope.pages=pages;$scope.$apply()},function(){$location.path("/auth")})};if($location.path()!=="/auth"){$scope.refreshPages()}});frontendApp.controller("PageController",function($scope,$log,$routeParams,communicator,parser){communicator.getPage($routeParams.plugin,$routeParams.page).then(function(page){parser.parsePage(page).then(function(components){$scope.components=components;$scope.$apply()})})});frontendApp.directive("cleverCheckbox",function(){return{templateUrl:"/src/html/directives/checkbox.html",restrict:"E",scope:{name:"=name",value:"=value",label:"=label"}}});frontendApp.directive("cleverHtml",function(){return{templateUrl:"/src/html/directives/htmlView.html",restrict:"E",scope:{icode:"=code"},controller:function($scope,$sce){$scope.code=$sce.trustAs($sce.HTML,$scope.icode)}}});frontendApp.directive("cleverImage",function(){return{templateUrl:"/src/html/directives/image.html",restrict:"E",scope:{iurl:"=url"},controller:function($scope,$sce){$scope.url=$sce.trustAs($sce.URL,$scope.iurl)}}});frontendApp.directive("cleverInputfield",function(){return{templateUrl:"/src/html/directives/inputField.html",restrict:"E",scope:{name:"=name",value:"=value",label:"=label",placeholder:"=placeholder"}}});frontendApp.directive("cleverLabel",function(){return{templateUrl:"/src/html/directives/label.html",restrict:"E",scope:{text:"=text"}}});frontendApp.directive("cleverTextarea",function(){return{templateUrl:"/src/html/directives/Textarea.html",restrict:"E",scope:{name:"=name",value:"=value",label:"=label",placeholder:"=placeholder"}}});frontendApp.directive("cleverYoutube",function(){return{templateUrl:"/src/html/directives/youtube.html",restrict:"E",scope:{iurl:"=url",width:"=width",height:"=height"},controller:function($scope,$sce){var patt=/https:\/\/www\.youtube\.com\/watch\?v=(.*)/;var test=patt.test($scope.iurl);if(test==true){var id=patt.exec($scope.iurl)[1];$scope.eurl="https://www.youtube.com/embed/"+id}if(test==false){$scope.urlError=true}$scope.url=$sce.trustAs($sce.RESOURCE_URL,$scope.eurl);$scope.width=420;$scope.height=315}}});frontendApp.factory("auth",function($http){return{auth:function(username,password){return new Promise(function(resolve,reject){if(typeof host!=="undefined"){var url=host+"auth"}else{var url="/backend/"+"auth"}$http({method:"POST",url:url,data:{username:username,password:password,lifetime:86400}}).then(function successCallback(response){if(response.data.status==200){sessionStorage.setItem("token",response.data.body);resolve("Success (200)")}else{reject("Non 200 Status ("+response.data.status+")")}},function errorCallback(response){reject("Error ("+response.status+")")})})},getToken:function(){return sessionStorage.getItem("token")}}});frontendApp.factory("communicator",function($http,auth){return{getPages:function(){return new Promise(function(resolve,reject){if(typeof host!=="undefined"){var url=host+"pages"}else{var url="/backend/pages"}$http({method:"GET",url:url,headers:{token:auth.getToken()}}).then(function successCallback(response){if(response.data.status==200){resolve(response.data.body)}else{reject("Non 200 Status ("+response.data.status+")")}},function errorCallback(response){reject("Error ("+response.status+")")})})},getPage:function(plugin,page){return new Promise(function(resolve,reject){if(typeof host!=="undefined"){var url=host+plugin+"/"+page}else{var url="/backend/"+plugin+"/"+page}$http({method:"GET",url:url,headers:{token:auth.getToken()}}).then(function successCallback(response){if(response.data.status==200){resolve(response.data.body)}else{reject("Non 200 Status ("+response.data.status+")")}},function errorCallback(response){reject("Error ("+response.status+")")})})}}});frontendApp.factory("parser",function($sce){return{parsePage:function(page){return new Promise(function(resolve,reject){var components=page.components;resolve(components)})}}});